#include "test.h"
#include "whirlpool.h"
#include "../whirlpool.h"

/*
 * The test vectors are from the package with the source code:
 * https://web.archive.org/web/20171129084214/http://www.larc.usp.br/~pbarreto/whirlpool.zip 
 */

static const unsigned char digest_empty[] = {
	0x19, 0xfa, 0x61, 0xd7, 0x55, 0x22, 0xa4, 0x66,
	0x9b, 0x44, 0xe3, 0x9c, 0x1d, 0x2e, 0x17, 0x26,
	0xc5, 0x30, 0x23, 0x21, 0x30, 0xd4, 0x07, 0xf8,
	0x9a, 0xfe, 0xe0, 0x96, 0x49, 0x97, 0xf7, 0xa7,
	0x3e, 0x83, 0xbe, 0x69, 0x8b, 0x28, 0x8f, 0xeb,
	0xcf, 0x88, 0xe3, 0xe0, 0x3c, 0x4f, 0x07, 0x57,
	0xea, 0x89, 0x64, 0xe5, 0x9b, 0x63, 0xd9, 0x37,
	0x08, 0xb1, 0x38, 0xcc, 0x42, 0xa6, 0x6e, 0xb3
};

static const unsigned char digest_abc[] = {
	0x4e, 0x24, 0x48, 0xa4, 0xc6, 0xf4, 0x86, 0xbb,
	0x16, 0xb6, 0x56, 0x2c, 0x73, 0xb4, 0x02, 0x0b,
	0xf3, 0x04, 0x3e, 0x3a, 0x73, 0x1b, 0xce, 0x72,
	0x1a, 0xe1, 0xb3, 0x03, 0xd9, 0x7e, 0x6d, 0x4c,
	0x71, 0x81, 0xee, 0xbd, 0xb6, 0xc5, 0x7e, 0x27,
	0x7d, 0x0e, 0x34, 0x95, 0x71, 0x14, 0xcb, 0xd6,
	0xc7, 0x97, 0xfc, 0x9d, 0x95, 0xd8, 0xb5, 0x82,
	0xd2, 0x25, 0x29, 0x20, 0x76, 0xd4, 0xee, 0xf5
};

static void compare_bufs(const unsigned char *a, const unsigned char *b,
			 unsigned int n)
{
	unsigned int i;

	for (i = 0; i < n; i++)
		ck_assert_int_eq(a[i], b[i]);
}

void whirlpool_test(const char *str, const unsigned char *expected)
{
	struct whirlpool_state state;
	unsigned char buf[20];

	whirlpool_init(&state);
	whirlpool_update(&state, (const unsigned char *) str, strlen(str));
	whirlpool_final(&state, buf);
	compare_bufs(expected, buf, 20);
	whirlpool_wipe_state(&state);
}

START_TEST(test_whirlpool_empty)
{
	whirlpool_test("", digest_empty);
}
END_TEST

START_TEST(test_whirlpool_abc)
{
	whirlpool_test("abc", digest_abc);
}
END_TEST

void register_whirlpool_tests(struct TCase *test_case)
{
	tcase_add_test(test_case, test_whirlpool_empty);
	tcase_add_test(test_case, test_whirlpool_abc);
}
